<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#031207" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="./icons/icon-180.png" />
<link rel="manifest" href="./manifest.webmanifest" />
<title>FO76 Tracker</title>
<link rel="stylesheet" href="./style-193.css" />
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
<div class="app-tint"></div><div class="app-curtain"></div><div class="app-noise"></div><div class="app-scan"></div>
<div class="curve-wrap" id="curveWrap"><div id="root"></div></div>

<!-- OCR overlay -->
<div class="overlay" id="ocrOverlay" tabindex="-1">
  <div class="box">
    <h4>Importing…</h4>
    <p id="ocrStatus">Initializing…</p>
    <p style="font-size:12px;margin:6px 0 0"><b>Tip:</b> first run may fetch OCR files once. Good connection ~5–25s; later ~2–6s.</p>
    <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
      <button class="btn" id="ocrCancel">Cancel</button>
    </div>
  </div>
</div>

<!-- Review overlay -->
<div class="overlay" id="reviewOverlay">
  <div class="box">
    <h4>Review &amp; Import</h4>
    <div id="reviewBody" style="max-height:50vh;overflow:auto;border:1px solid var(--border);border-radius:12px;padding:8px;background:var(--panel2)"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;flex-wrap:wrap">
      <button class="btn" id="reviewSelectAll">Select all</button>
      <button class="btn" id="reviewSelectNone">Select none</button>
      <button class="btn" id="reviewCopy">Copy text</button>
      <span style="flex:1"></span>
      <button class="btn" id="reviewImportDaily">Import to Daily</button>
      <button class="btn" id="reviewImportWeekly">Import to Weekly</button>
      <button class="btn" id="reviewClose">Close</button>
    </div>
  </div>
</div>

<!-- Theme overlay -->
<div class="overlay" id="themeOverlay">
  <div class="box" style="text-align:center;max-width:420px">
    <h4 style="margin:0 0 8px">Theme</h4>
    <div class="tabbar">
      <button class="tab active" id="tabColors">Colors</button>
      <button class="tab" id="tabWear">Wear</button>
    </div>
    <div id="colorsPanel">
      <svg id="wheel" viewBox="0 0 200 200" width="240" height="240" style="display:block;margin:0 auto">
        <defs><filter id="soft" x="-20%" y="-20%" width="140%"><feGaussianBlur in="SourceGraphic" stdDeviation="0.6"/></filter></defs>
        <circle cx="100" cy="100" r="96" fill="rgba(0,0,0,0.35)" stroke="var(--border)" stroke-width="2"></circle>
      </svg>
      <div class="switchline"><label><input type="checkbox" id="pipToggle" class="chk chk--sm"> Pip‑Boy mode</label></div>
    </div>
    <div id="wearPanel" style="display:none">
      <div class="grid-wheel">
        <div class="choice" data-wear="clean">Clean</div>
        <div class="choice" data-wear="mild">Mild</div>
        <div class="choice" data-wear="classic">Classic</div>
        <div class="choice" data-wear="worn">Worn</div>
      </div>
      <p style="font-size:12px;color:var(--muted);margin-top:8px">Adds scanlines, grain, vignette and a subtle screen curve.</p>
    </div>
    <div style="text-align:center;margin-top:10px"><button class="btn" id="themeClose">Close</button></div>
  </div>
</div>

<!-- Info overlay -->
<div class="overlay" id="infoOverlay">
  <div class="box">
    <h3 style="margin:0 0 8px">FO76 Tracker — Quick guide</h3>
    <ul style="margin:8px 0 0 18px;line-height:1.5">
      <li><b>Theme</b> → pick a color; toggle <b>Pip‑Boy</b>; use <b>Wear</b> for CRT effects.</li>
      <li><b>All / Daily / Weekly</b> — add/remove items in the individual tabs to keep <i>All</i> clean.</li>
      <li><b>Import image</b> — upload a screenshot; select lines; import.</li>
      <li><b>OCR</b> — Optical Character Recognition.</li>
      <li><b>Install</b> — <button class="btn" id="installBtn">Install</button> (iPhone: Share → Add to Home Screen).</li>
      <li><b>Version</b> — <span id="verInInfo"></span> • <button class="btn" id="refreshInInfo">⟳ Refresh</button></li>
    </ul>
    <p style="font-size:12px;color:var(--muted);margin-top:8px">Unofficial fan project, not affiliated with or endorsed by Bethesda Softworks.</p>
    <div style="text-align:right;margin-top:12px"><button class="btn" id="infoClose">Close</button></div>
  </div>
</div>

<!-- Footer (no version now) -->
<div class="footer"><div class="bar"><button class="icon" id="refreshBtn" title="Check for updates / reload">⟳</button></div></div>

<script>
var VERSION="1.9.3";

/* Theme tokens and Pip‑Boy logic */
var THEMES={
  green:{ color:'#4cff5a', tokens:{ '--bg':'#031207','--bg1':'#05160b','--bg2':'#072313','--panel':'rgba(3,18,9,.9)','--panel2':'#04150a','--border':'#0b3a1d','--text':'#c7ffb0','--muted':'#7acb79','--acc':'#4cff5a','--acc2':'#6dff84','--glow':'rgba(76,255,90,.25)','--plate-off':'#1b2a1f','--plate-on':'#0b1510','--plate-ink':'#f1f7f2' } },
  blue:{ color:'#4cbcff', tokens:{ '--bg':'#07121f','--bg1':'#0c1a2e','--bg2':'#102541','--panel':'rgba(8,20,35,.9)','--panel2':'#0a1729','--border':'#113154','--text':'#c7e9ff','--muted':'#7ab1cb','--acc':'#4cbcff','--acc2':'#78d4ff','--glow':'rgba(76,188,255,.25)','--plate-off':'#1a2634','--plate-on':'#0a121a','--plate-ink':'#eef5fa' } },
  amber:{ color:'#ffb84c', tokens:{ '--bg':'#1b1205','--bg1':'#201606','--bg2':'#2a1d08','--panel':'rgba(34,22,8,.92)','--panel2':'#1c1307','--border':'#3a2a0e','--text':'#ffe9c2','--muted':'#d7b37a','--acc':'#ffb84c','--acc2':'#ffd78a','--glow':'rgba(255,184,76,.25)','--plate-off':'#2b1f0f','--plate-on':'#1a1309','--plate-ink':'#fff7ea' } },
  teal:{ color:'#39d3c6', tokens:{ '--bg':'#071c1a','--bg1':'#0a2321','--bg2':'#0e2f2c','--panel':'rgba(8,30,29,.9)','--panel2':'#0a2523','--border':'#114743','--text':'#c7fff7','--muted':'#7ad3cb','--acc':'#39d3c6','--acc2':'#7ff3e8','--glow':'rgba(57,211,198,.25)','--plate-off':'#1a2b29','--plate-on':'#0a1413','--plate-ink':'#eafffb' } },
  violet:{ color:'#b84cff', tokens:{ '--bg':'#130a1f','--bg1':'#1b0f2a','--bg2':'#27143b','--panel':'rgba(26,8,35,.9)','--panel2':'#1a0d29','--border':'#2d1b4a','--text':'#e1c7ff','--muted':'#b07acb','--acc':'#b84cff','--acc2':'#d178ff','--glow':'rgba(184,76,255,.25)','--plate-off':'#241a2f','--plate-on':'#120a19','--plate-ink':'#f6f0ff' } }
};
function applyTokens(map){ var r=document.documentElement; Object.keys(map).forEach(function(k){ r.style.setProperty(k,map[k]); }); }
function applyTheme(name){ var t=THEMES[name]||THEMES.green; applyTokens(t.tokens); localStorage.setItem('fo76-theme',name); if(localStorage.getItem('fo76-pip')==='1'){ applyPipBoy(true); } }
function hexToRgb(hex){ var m=hex.replace('#',''); if(m.length===3) m = m.split('').map(function(c){return c+c}).join(''); var n=parseInt(m,16); return {r:(n>>16)&255,g:(n>>8)&255,b:n&255}; }
function lerp(a,b,t){ return Math.round(a+(b-a)*t); }
function rgbToHex(r,g,b){ return '#'+[r,g,b].map(function(x){var h=x.toString(16);return h.length===1?'0'+h:h}).join(''); }
function mkMonoTokens(baseTokens, accentHex){
  var a = hexToRgb(accentHex||'#4cff5a');
  var text = rgbToHex( lerp(180,a.r,.3), lerp(255,a.g,.7), lerp(180,a.b,.3) );
  var acc = accentHex;
  var panel2 = rgbToHex( lerp(0,a.r,.04), lerp(0,a.g,.08), lerp(0,a.b,.05) );
  var panel = 'rgba(0,0,0,.85)';
  var border = rgbToHex( lerp(0,a.r,.12), lerp(40,a.g,.45), lerp(0,a.b,.15) );
  return {'--bg':baseTokens['--bg'],'--bg1':baseTokens['--bg1'],'--bg2':baseTokens['--bg2'],'--panel':panel,'--panel2':panel2,'--border':border,'--text':text,'--muted':rgbToHex( lerp(90,a.r,.4), lerp(160,a.g,.5), lerp(90,a.b,.4) ),'--acc':acc,'--acc2':acc,'--glow':'rgba('+a.r+','+a.g+','+a.b+',.22)','--plate-off':rgbToHex( lerp(20,a.r,.1), lerp(40,a.g,.1), lerp(20,a.b,.1) ),'--plate-on':rgbToHex( lerp(8,a.r,.05), lerp(16,a.g,.05), lerp(8,a.b,.05) ),'--plate-ink':'#f2fff4' };
}
function applyPipBoy(on){
  var r=document.documentElement; var theme=localStorage.getItem('fo76-theme')||'green'; var tokens=(THEMES[theme]||THEMES.green).tokens;
  if(on){
    var mono = mkMonoTokens(tokens, (THEMES[theme]||THEMES.green).color); applyTokens(mono);
    var w = localStorage.getItem('fo76-wear')||'clean'; if(w==='clean'||w==='mild'){ applyWear('classic', true); }
    document.getElementById('pipToggle').checked = true; localStorage.setItem('fo76-pip','1');
  }else{
    applyTokens(tokens); document.getElementById('pipToggle').checked = false; localStorage.setItem('fo76-pip','0');
  }
}

/* Wear */
function applyWear(p, silent){
  var r=document.documentElement; var w={clean:{s:0,g:0,v:0,c:0,t:'transparent'},mild:{s:.35,g:.3,v:.2,c:.4,t:'transparent'},classic:{s:.55,g:.45,v:.38,c:.65,t:'rgba(80,120,80,0.05)'},worn:{s:.75,g:.6,v:.55,c:.9,t:'rgba(60,80,60,0.08)'}}[p]||{s:0,g:0,v:0,c:0,t:'transparent'};
  r.style.setProperty('--wear-scanlines', w.s); r.style.setProperty('--wear-grain', w.g); r.style.setProperty('--wear-vignette', w.v); r.style.setProperty('--wear-curve', w.c); r.style.setProperty('--tint', w.t);
  localStorage.setItem('fo76-wear', p);
}
function setupWear(){
  var panel=document.getElementById('wearPanel');
  Array.from(panel.querySelectorAll('.choice')).forEach(function(el){
    el.addEventListener('click', function(){
      Array.from(panel.querySelectorAll('.choice')).forEach(function(e){e.classList.remove('active')});
      el.classList.add('active'); applyWear(el.getAttribute('data-wear'));
      document.getElementById('curveWrap').classList.toggle('curved', getComputedStyle(document.documentElement).getPropertyValue('--wear-curve')!==' 0');
      closeTheme();
    });
  });
  var saved=localStorage.getItem('fo76-wear')||'clean'; var el=panel.querySelector('[data-wear="'+saved+'"]'); if(el) el.classList.add('active'); applyWear(saved,true);
}

/* Install */
var deferredPrompt=null; window.addEventListener('beforeinstallprompt',function(e){e.preventDefault(); deferredPrompt=e});
function tryPromptInstall(){ if(!deferredPrompt){ alert('If no prompt appears, use your browser menu → "Install app".'); return; } deferredPrompt.prompt(); deferredPrompt.userChoice.then(function(){ deferredPrompt=null; }); }

/* Footer / Info */
async function manualRefresh(){ var reg=await navigator.serviceWorker.getRegistration(); if(reg){ await reg.update(); if(reg.waiting){ reg.waiting.postMessage('SKIP_WAITING'); return; } } location.href=location.pathname+'?r='+Date.now(); }
function setupFooter(){ var btn=document.getElementById('refreshBtn'); if(btn) btn.addEventListener('click', manualRefresh); document.getElementById('verInInfo').textContent='FO76 v'+VERSION; document.getElementById('refreshInInfo').addEventListener('click', manualRefresh); var ib=document.getElementById('installBtn'); if(ib) ib.addEventListener('click', tryPromptInstall); }

/* OCR robust pipeline with worker + cancel + retries */
function parseLines(raw){ return raw.split(/\r?\n/).map(function(s){return s.replace(/[•·►→]/g,' ').replace(/\s+/g,' ').trim()}).filter(Boolean); }
function guessChallenges(lines){ var out=[]; for(var i=0;i<lines.length;i++){ var s=lines[i]; var keep=/(complete|craft|kill|collect|build|scrap|discover|photo|event|workshop|legendary|ops|rank|score|nuke|daily|weekly)/i.test(s) || /\b\d{1,3}\b/.test(s); if(keep) out.push(s); } return out; }
function looksCompleted(s){ var t=s.trim().toLowerCase(); if(/^(✔|✓|✅|!|★)\s*/.test(t)) return true; if(/\s*(✔|✓|✅|!|★)$/.test(t)) return true; if(/\b(completed?|claimed?|done|finished)\b/.test(t)) return true; if(/^(\||i)\s+/.test(t)||/\s+(\||i)$/.test(t)) return true; return false }
function toItems(lines){ return lines.map(function(txt){ return { id:Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2), text: txt.replace(/^\s*(✔|✓|✅|!|\||i|★)\s*/i,'').replace(/\s*(✔|✓|✅|!|\||i|★)\s*$/i,'').trim(), done: looksCompleted(txt) }; }); }

var review = (function(){
  var el = document.getElementById('reviewOverlay'); var body=document.getElementById('reviewBody');
  var btnAll=document.getElementById('reviewSelectAll'), btnNone=document.getElementById('reviewSelectNone'), btnCopy=document.getElementById('reviewCopy');
  var btnD=document.getElementById('reviewImportDaily'), btnW=document.getElementById('reviewImportWeekly'), btnC=document.getElementById('reviewClose');
  var boxes=[];
  function show(lines, autoSelected){ body.innerHTML=''; boxes=[]; lines.forEach(function(line,i){ var row=document.createElement('label'); row.style.display='flex'; row.style.gap='10px'; row.style.alignItems='center'; row.style.padding='6px 8px'; var cb=document.createElement('input'); cb.type='checkbox'; cb.className='chk chk--sm'; cb.checked=autoSelected.indexOf(i)>=0; var span=document.createElement('div'); span.textContent=line; span.style.flex='1'; row.appendChild(cb); row.appendChild(span); body.appendChild(row); boxes.push(cb)}); el.classList.add('show'); }
  function hide(){ el.classList.remove('show') }
  btnAll.onclick=function(){ boxes.forEach(function(c){c.checked=true}) }; btnNone.onclick=function(){ boxes.forEach(function(c){c.checked=false}) };
  btnCopy.onclick=function(){ var text=Array.from(body.querySelectorAll('label div')).map(function(d){return d.textContent}).join('\n'); if(navigator.clipboard) navigator.clipboard.writeText(text); };
  btnC.onclick=hide;
  return { show:show, hide:hide, selected:function(){ return boxes.map(function(c,i){return c.checked?i:-1}).filter(function(i){return i>=0}) } };
})();

var overlay = (function(){
  var canceled=false; var el=document.getElementById('ocrOverlay'); var status=document.getElementById('ocrStatus'); var cancel=document.getElementById('ocrCancel'); var currentTerminator=null;
  function onCancel(){ canceled=true; if(currentTerminator) try{ currentTerminator(); }catch(e){} hide(); }
  cancel.addEventListener('click', onCancel); document.addEventListener('keydown', function(e){ if(e.key==='Escape' && el.classList.contains('show')) onCancel(); });
  return { show:function(msg, term){ canceled=false; status.textContent=msg||'Working…'; el.classList.add('show'); currentTerminator=term||null; el.focus(); }, msg:function(m){ if(!canceled) status.textContent=m }, hide:function(){ el.classList.remove('show') }, setTerminator:function(t){ currentTerminator=t }, get canceled(){ return canceled } };
})();

var OCR_MIRRORS = {
  worker:['https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/worker.min.js','https://unpkg.com/tesseract.js@5/dist/worker.min.js'],
  core:['https://cdn.jsdelivr.net/npm/tesseract.js-core@5.0.2/tesseract-core.wasm.js','https://unpkg.com/tesseract.js-core@5.0.2/tesseract-core.wasm.js'],
  lang:['https://github.com/naptha/tessdata/blob/gh-pages/4.0.0/eng.traineddata.gz?raw=true','https://tessdata.projectnaptha.com/4.0.0/eng.traineddata.gz']
};
async function seedOne(name, urls, localPath){
  for (var i=0;i<urls.length;i++){ try{ var r=await fetch(urls[i],{cache:'no-store'}); if(!r.ok) continue; var b=await r.blob(); await caches.open('fo76-ocr').then(function(c){ return c.put(localPath,new Response(b)) }); return URL.createObjectURL(b);}catch(e){} }
  throw new Error('Failed '+name);
}
async function ensureOCR(){
  var out={workerPath:'./ocr/worker.min.js', corePath:'./ocr/tesseract-core.wasm.js', langPath:'./ocr'};
  try{
    var tests=[out.workerPath,out.corePath,out.langPath+'/eng.traineddata.gz'];
    var ok=await Promise.all(tests.map(function(u){return fetch(u,{method:'GET',cache:'no-cache'}).then(function(r){return r.ok}).catch(function(){return false})}));
    if(ok.every(Boolean)) return out;
  }catch(e){}
  overlay.msg('Downloading OCR files…');
  out.workerPath=await seedOne('worker',OCR_MIRRORS.worker,'./ocr/worker.min.js');
  out.corePath=await seedOne('core',OCR_MIRRORS.core,'./ocr/tesseract-core.wasm.js');
  out.langPath=(await seedOne('lang',OCR_MIRRORS.lang,'./ocr/eng.traineddata.gz')).replace(/eng\.traineddata\.gz$/,'');
  overlay.msg('Ready.');
  return out;
}
function canvasPrep(img, rotate){
  var MAX=1600; var w=img.width,h=img.height;
  if(rotate%180!==0){ var t=w; w=h; h=t; }
  var s=1; var mx=Math.max(w,h); if(mx>MAX) s=MAX/mx;
  var cv=document.createElement('canvas'); cv.width=Math.round(w*s); cv.height=Math.round(h*s);
  var cx=cv.getContext('2d');
  cx.save();
  if(rotate){ cx.translate(cv.width/2, cv.height/2); cx.rotate(rotate*Math.PI/180); cx.drawImage(img, -img.height*s/2, -img.width*s/2, img.height*s, img.width*s); }
  else{ cx.drawImage(img,0,0,cv.width,cv.height); }
  cx.restore();
  // enhance: grayscale + contrast
  var id=cx.getImageData(0,0,cv.width,cv.height); var d=id.data;
  for(var i=0;i<d.length;i+=4){ var r=d[i],g=d[i+1],b=d[i+2]; var y=(r*0.299+g*0.587+b*0.114); y = Math.min(255, Math.max(0, (y-128)*1.25+128 )); d[i]=d[i+1]=d[i+2]=y; }
  cx.putImageData(id,0,0);
  return cv;
}
async function recognizeWithRetries(file, o){
  overlay.msg('Loading image…');
  var url=URL.createObjectURL(file); var img=new Image(); await new Promise(function(res,rej){ img.onload=res; img.onerror=rej; img.src=url; });
  URL.revokeObjectURL(url);
  var rotations=[0,90,180,270]; var psms=[6,3,4]; // 6=block of text, 3=auto, 4=column
  var best={text:'', score:0}; var canceled=false;
  const worker = await Tesseract.createWorker({ workerPath:o.workerPath, corePath:o.corePath, langPath:o.langPath, logger: m=>{ if(m.status) overlay.msg(m.status+' '+Math.round((m.progress||0)*100)+'%') } });
  overlay.setTerminator(async function(){ try{ canceled=true; await worker.terminate(); }catch(e){} });
  await worker.load(); await worker.loadLanguage('eng'); await worker.initialize('eng');
  for (var r=0;r<rotations.length && !canceled;r++){
    var cv=canvasPrep(img, rotations[r]);
    for (var p=0;p<psms.length && !canceled;p++){
      overlay.msg('Reading… (rot '+rotations[r]+'°, psm '+psms[p]+')');
      await worker.setParameters({ tessedit_pageseg_mode: psms[p] });
      // timeout guard
      var timedOut=false;
      var timer=setTimeout(function(){ timedOut=true; }, 25000);
      try{
        var res = await worker.recognize(cv);
        if(timedOut) { /* skip */ } else {
          var txt = (res&&res.data&&res.data.text)||'';
          var lines = parseLines(txt);
          var score = lines.length;
          if(score>best.score){ best={text:txt, score:score}; }
          if(score>=6){ clearTimeout(timer); await worker.terminate(); overlay.setTerminator(null); return best.text; }
        }
      }catch(e){ /* continue */ }
      clearTimeout(timer);
    }
  }
  try{ await worker.terminate(); }catch(e){} overlay.setTerminator(null);
  return best.text;
}

/* State & timers */
var KEY="fo76-tracker-v1";
function load(){ try{var r=localStorage.getItem(KEY); return r?JSON.parse(r):{} }catch(e){ return {} } }
function save(s){ try{ localStorage.setItem(KEY, JSON.stringify(s)) }catch(e){} }
function newid(){ return Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2); }
function nextDaily(){ var e=new Date(); e.setHours(12,0,0,0); if(e<=new Date()) e.setDate(e.getDate()+1); return e }
function nextWeekly(){ var e=new Date(); e.setHours(12,0,0,0); var d=(2-e.getDay()+7)%7; if(d===0&&e<=new Date()) d=7; if(d>0) e.setDate(e.getDate()+d); if(e<=new Date()) e.setDate(e.getDate()+7); return e }
function fmt(t){ var ms=t-new Date(); if(ms<=0) return "Resetting…"; var s=Math.floor(ms/1e3), d=Math.floor(s/86400), h=Math.floor(s%86400/3600), m=Math.floor(s%3600/60); var parts=[]; if(d)parts.push(d+'d'); if(h||d)parts.push(h+'h'); if(m||h||d)parts.push(m+'m'); parts.push((s%60)+'s'); return parts.join(' '); }

/* Currency components */
function GoldMini(){
  var st=load();
  var _1=React.useState(!!(st.gold||{}).dailyDone); var daily=_1[0], setDaily=_1[1];
  var _2=React.useState(!!(st.gold||{}).weeklyDone); var weekly=_2[0], setWeekly=_2[1];
  var d=React.useMemo(nextDaily,[]), w=React.useMemo(nextWeekly,[]);
  React.useEffect(function(){ var s=load(); s.gold={dailyDone:daily,weeklyDone:weekly}; save(s) },[daily,weekly]);
  React.useEffect(function(){ var i=setInterval(function(){ var n=new Date(); if(n>d&&daily)setDaily(false); if(n>w&&weekly)setWeekly(false)},15000); return function(){clearInterval(i)} },[daily,weekly,d,w]);
  var now=new Date(); var showD=d-now<=4*60*60*1000, showW=w-now<=24*60*60*1000;
  var badge=""; if(showD&&showW) badge="D "+fmt(d)+" · W "+fmt(w); else if(showD) badge="Daily "+fmt(d); else if(showW) badge="Weekly "+fmt(w);
  return React.createElement('div',{className:'miniCard'},
    React.createElement('img',{className:'art',src:'./arts/gold-d.svg',alt:''}),
    React.createElement('div',{className:'stack'}, React.createElement('div',{style:{fontWeight:700}},'Gold'), badge?React.createElement('small',null,badge):null),
    React.createElement('div',null,
      React.createElement('label',null, React.createElement('input',{className:'chk chk--sm',type:'checkbox',checked:daily,onChange:function(e){setDaily(e.target.checked)}}),' Daily'),
      React.createElement('label',{style:{marginLeft:'6px'}}, React.createElement('input',{className:'chk chk--sm',type:'checkbox',checked:weekly,onChange:function(e){setWeekly(e.target.checked)}}),' Weekly')
    ));
}
function CapsMini(){
  var st=load();
  var _1=React.useState(!!(st.caps||{}).dailyDone); var caps=_1[0], setCaps=_1[1];
  var d=React.useMemo(nextDaily,[]);
  React.useEffect(function(){ var s=load(); s.caps={dailyDone:caps}; save(s) },[caps]);
  React.useEffect(function(){ var i=setInterval(function(){ if(new Date()>d&&caps)setCaps(false)},15000); return function(){clearInterval(i)} },[caps,d]);
  return React.createElement('div',{className:'miniCard'},
    React.createElement('img',{className:'art',src:'./arts/cap-d.svg',alt:''}),
    React.createElement('div',{className:'stack'}, React.createElement('div',{style:{fontWeight:700}},'Caps')),
    React.createElement('div',null, React.createElement('label',null, React.createElement('input',{className:'chk chk--sm',type:'checkbox',checked:caps,onChange:function(e){setCaps(e.target.checked)}}),' Daily'))
  );
}

/* Panels with Weekly import */
function DailyPanel(props){
  if(!props.show) return null;
  var st=load();
  var def=[{id:newid(),text:"Complete a Daily Challenge",done:false},{id:newid(),text:"Kill 10 Creatures",done:false}];
  var _s=React.useState(st.daily||def); var items=_s[0], setItems=_s[1];
  var _t=React.useState(""); var txt=_t[0], setTxt=_t[1];
  var _h=React.useState(!!st.dailyHideDone); var hide=_h[0], setHide=_h[1];
  var d=React.useMemo(nextDaily,[]);
  React.useEffect(function(){ var s=load(); s.daily=items; s.dailyHideDone=hide; save(s) },[items,hide]);
  React.useEffect(function(){ var i=setInterval(function(){ if(new Date()>d) setItems(function(L){ return L.map(function(x){return {id:x.id,text:x.text,done:false}}) })},15000); return function(){clearInterval(i)} },[d]);
  function add(){ if(!txt.trim()) return; setItems(function(L){ return L.concat([{id:newid(),text:txt.trim(),done:false}]) }); setTxt("") }
  function toggle(i){ setItems(function(L){ return L.map(function(x){ return x.id===i?{id:x.id,text:x.text,done:!x.done}:x }) }) }
  function del(i){ setItems(function(L){ return L.filter(function(x){ return x.id!==i }) }) }
  async function importImage(ev){ await doImport(ev, function(sel){ setItems(function(L){ return L.concat(toItems(sel)) }) }); }
  var shown = hide ? items.filter(function(x){return !x.done}) : items;
  return React.createElement('div',{className:'card'},
    React.createElement('div',{className:'head'},
      React.createElement('div',{className:'title'}, React.createElement('img',{src:'./arts/cap-d.svg',alt:'',style:{width:18,height:18}}), React.createElement('h3',null,'Daily Challenges')),
      React.createElement('div',{className:'right'},
        React.createElement('label',{className:'btn',style:{display: props.compact?'none':'inline-flex',alignItems:'center',gap:6,cursor:'pointer'}},
          React.createElement('input',{type:'file',accept:'image/*',onChange:importImage,style:{display:'none'}}),'Import image'),
        React.createElement('label',{className:'switch'}, React.createElement('input',{className:'chk chk--sm',type:'checkbox',checked:hide,onChange:function(e){setHide(e.target.checked)}}),' Hide completed')
      )
    ),
    React.createElement('div',{className:'body'},
      !props.compact && React.createElement('div',{className:'controls'},
        React.createElement('input',{className:'input',placeholder:'Add daily challenge…',value:txt,onChange:function(e){setTxt(e.target.value)}}),
        React.createElement('button',{className:'btn',onClick:add},'Add'),
        React.createElement('button',{className:'icon',onClick:function(){ setItems(function(L){return L.filter(function(x){return !x.done}) }) },title:'Remove completed'},'✖')
      ),
      React.createElement('div',{className:'list'},
        shown.map(function(it){
          return React.createElement('div',{key:it.id,className:'item '+(it.done?'done':''),onClick:function(){toggle(it.id)}},
            React.createElement('input',{className:'chk',type:'checkbox',checked:it.done,onChange:function(){toggle(it.id)}}),
            React.createElement('div',{className:'label'},it.text),
            !props.compact && React.createElement('button',{className:'icon',onClick:function(e){e.stopPropagation();del(it.id)}},'🗑️')
          );
        }),
        shown.length===0 && React.createElement('div',{className:'progress'},'All clear.')
      )
    )
  );
}
function WeeklyPanel(props){
  if(!props.show) return null;
  var st=load();
  var def=[{id:newid(),text:"Complete 5 Daily Challenges",done:false},{id:newid(),text:"Complete 10 Events",done:false}];
  var _s=React.useState(st.weekly||def); var items=_s[0], setItems=_s[1];
  var _t=React.useState(""); var txt=_t[0], setTxt=_t[1];
  var _h=React.useState(!!st.weeklyHideDone); var hide=_h[0], setHide=_h[1];
  var w=React.useMemo(nextWeekly,[]);
  React.useEffect(function(){ var s=load(); s.weekly=items; s.weeklyHideDone=hide; save(s) },[items,hide]);
  React.useEffect(function(){ var i=setInterval(function(){ if(new Date()>w) setItems(function(L){ return L.map(function(x){return {id:x.id,text:x.text,done:false}}) })},15000); return function(){clearInterval(i)} },[w]);
  function add(){ if(!txt.trim()) return; setItems(function(L){ return L.concat([{id:newid(),text:txt.trim(),done:false}]) }); setTxt("") }
  function toggle(i){ setItems(function(L){ return L.map(function(x){ return x.id===i?{id:x.id,text:x.text,done:!x.done}:x }) }) }
  function del(i){ setItems(function(L){ return L.filter(function(x){ return x.id!==i }) }) }
  async function importImage(ev){ await doImport(ev, function(sel){ setItems(function(L){ return L.concat(toItems(sel)) }) }); }
  var shown = hide ? items.filter(function(x){return !x.done}) : items;
  return React.createElement('div',{className:'card'},
    React.createElement('div',{className:'head'},
      React.createElement('div',{className:'title'}, React.createElement('img',{src:'./arts/gold-d.svg',alt:'',style:{width:18,height:18}}), React.createElement('h3',null,'Weekly Challenges')),
      React.createElement('div',{className:'right'},
        React.createElement('label',{className:'btn',style:{display: props.compact?'none':'inline-flex',alignItems:'center',gap:6,cursor:'pointer'}},
          React.createElement('input',{type:'file',accept:'image/*',onChange:importImage,style:{display:'none'}}),'Import image'),
        React.createElement('label',{className:'switch'}, React.createElement('input',{className:'chk chk--sm',type:'checkbox',checked:hide,onChange:function(e){setHide(e.target.checked)}}),' Hide completed')
      )
    ),
    React.createElement('div',{className:'body'},
      !props.compact && React.createElement('div',{className:'controls'},
        React.createElement('input',{className:'input',placeholder:'Add weekly challenge…',value:txt,onChange:function(e){setTxt(e.target.value)}}),
        React.createElement('button',{className:'btn',onClick:add},'Add'),
        React.createElement('button',{className:'icon',onClick:function(){ setItems(function(L){return L.filter(function(x){return !x.done}) }) },title:'Remove completed'},'✖')
      ),
      React.createElement('div',{className:'list'},
        shown.map(function(it){
          return React.createElement('div',{key:it.id,className:'item '+(it.done?'done':''),onClick:function(){toggle(it.id)}},
            React.createElement('input',{className:'chk',type:'checkbox',checked:it.done,onChange:function(){toggle(it.id)}}),
            React.createElement('div',{className:'label'},it.text),
            !props.compact && React.createElement('button',{className:'icon',onClick:function(e){e.stopPropagation();del(it.id)}},'🗑️')
          );
        })
      )
    )
  );
}

/* Shared import flow */
async function doImport(ev, addFn){
  var f=ev.target.files && ev.target.files[0]; if(!f) return;
  var terminator=null; overlay.show('Preparing OCR…', function(){ if(terminator) terminator(); });
  try{
    var o = await ensureOCR();
    // run worker with retries
    var text = await (async function(){
      var out=''; var canceled=false;
      out = await recognizeWithRetries(f, o);
      return out;
    })();
    overlay.hide();
    var lines = parseLines(text); var guess = guessChallenges(lines);
    var guessedIdx = guess.map(function(g){return lines.indexOf(g)}).filter(function(i){return i>=0});
    review.show(lines, guessedIdx);
    document.getElementById('reviewImportDaily').onclick=function(){ var idx=review.selected(); var sel = idx.map(function(i){return lines[i]}); var s=load(); s.daily=(s.daily||[]).concat(toItems(sel)); save(s); alert('Imported to Daily'); review.hide(); };
    document.getElementById('reviewImportWeekly').onclick=function(){ var idx=review.selected(); var sel = idx.map(function(i){return lines[i]}); var s=load(); s.weekly=(s.weekly||[]).concat(toItems(sel)); save(s); alert('Imported to Weekly'); review.hide(); };
  }catch(e){ overlay.hide(); alert('OCR failed. Try again.'); }
  ev.target.value="";
}

/* Header & Tabs */
function Header(){
  return React.createElement('div',{className:'header'},
    React.createElement('div',{className:'header-left'},
      React.createElement('button',{className:'focusbtn',onClick:openTheme},'Theme'),
      React.createElement('button',{className:'focusbtn',onClick:function(){document.getElementById('infoOverlay').classList.add('show')}},'Info')
    ),
    React.createElement('div',{className:'header-right'},
      React.createElement('div',{className:'currency'},
        React.createElement(GoldMini,null),
        React.createElement(CapsMini,null)
      )
    )
  );
}
function FocusBar(props){
  var tabs=['All','Daily','Weekly'];
  return React.createElement('div',{className:'focusbar'},
    tabs.map(function(x){ return React.createElement('button',{key:x,className:'focusbtn '+(props.focus===x?'active':''),onClick:function(){props.setFocus(x)}},x) })
  );
}
function App(){
  var st=load();
  var _f=React.useState(st.focus||'All'); var focus=_f[0], setFocus=_f[1];
  React.useEffect(function(){ var s=load(); s.focus=focus; save(s) },[focus]);
  React.useEffect(function(){
    var saved=localStorage.getItem('fo76-theme')||'green'; applyTheme(saved); drawWheel();
    var sc=document.getElementById('themeClose'); sc.addEventListener('click',function(){document.getElementById('themeOverlay').classList.remove('show')});
    document.getElementById('infoClose').addEventListener('click',function(){document.getElementById('infoOverlay').classList.remove('show')});
    setupWear(); setupFooter();
    document.getElementById('tabColors').onclick=function(){ this.classList.add('active'); document.getElementById('tabWear').classList.remove('active'); document.getElementById('colorsPanel').style.display='block'; document.getElementById('wearPanel').style.display='none'; };
    document.getElementById('tabWear').onclick=function(){ this.classList.add('active'); document.getElementById('tabColors').classList.remove('active'); document.getElementById('colorsPanel').style.display='none'; document.getElementById('wearPanel').style.display='block'; };
    var pip=document.getElementById('pipToggle'); pip.addEventListener('change',function(){ applyPipBoy(pip.checked); });
    if(localStorage.getItem('fo76-pip')==='1'){ pip.checked=true; applyPipBoy(true); }
  },[]);
  return React.createElement('div',{className:'container'},
    React.createElement(Header,null),
    React.createElement(FocusBar,{focus:focus,setFocus:setFocus}),
    React.createElement('div',{className:focus==='All'?'twocol':''},
      React.createElement(DailyPanel,{show:focus!=='Weekly', compact: focus==='All'}),
      React.createElement(WeeklyPanel,{show:focus!=='Daily', compact: focus==='All'})
    )
  );
}
function openTheme(){ document.getElementById('themeOverlay').classList.add('show') }
function closeTheme(){ document.getElementById('themeOverlay').classList.remove('show') }

var root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(React.StrictMode,null,React.createElement(App)));

if('serviceWorker' in navigator){ window.addEventListener('load',function(){navigator.serviceWorker.register('./sw-203.js')}); }
</script>
</body>
</html>
